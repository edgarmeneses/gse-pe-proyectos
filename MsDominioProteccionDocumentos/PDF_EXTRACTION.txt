# INFORMACIÓN COMPLETA DEL MICROSERVICIO EXTRAÍDA DEL PDF

## 1. NOMBRE DEL MICROSERVICIO
MsDominioProteccionDocumentos

## 2. CONTEXTO DE NEGOCIO

### Organización:
- RENIEC (Registro Nacional de Identificación y Estado Civil)
- Organismo técnico autónomo encargado de la identificación de los peruanos, otorgar el Documento Nacional de Identidad (DNI) y registrar los hechos vitales

### Proyecto:
- DNI Electrónico (DNIe) - Documento de identidad que incorpora tecnología de chip y biometría
- Marco: Modernización y transformación digital del Estado peruano
- Plataforma: SIIRC

### Propósito del Microservicio:
El Microservicio Protección Documentos es un componente de soporte y utilidad dentro de la plataforma SIIRC, esencial para la seguridad y el manejo eficiente de archivos. Su propósito principal es:
- Implementar la política de seguridad de distribución documental
- Comprimir documentos sensibles
- Generar y asignar una contraseña al archivo comprimido resultante
- Asegurar que cualquier documento creado pueda ser protegido con clave de acceso al momento de su distribución, conforme a la configuración del sistema

## 3. VERSIÓN DEL API
v1 (Version 1.0)
- Versión del Documento: 1.0
- Fecha de Actualización: 24/11/2025
- Fecha de Generación: 01/12/2025

## 4. ENDPOINTS COMPLETOS

### ENDPOINT 1: Comprimir y Proteger Documento

#### Información General:
- Path: /api/v1/documentos/MsProteccionDocumentos/comprimir-proteger
- API Gateway: Interno
- Método HTTP: POST
- Protocolo: REST/HTTP

#### HEADERS (Obligatorios y Opcionales):
- Authorization: String (Bearer token JWT para autenticación del usuario)
- Content-Type: String ("application/json")
- X-Correlation-ID: UUID (Identificador único de correlación para trazabilidad end-to-end)
- X-Office-Code: String (Código de oficina o sede desde donde se realiza la operación)
- X-User-Role: String (Rol del usuario que realiza la operación)
- X-Request-Source: String (Origen de la solicitud: WEB, MOBILE, KIOSK, API_EXTERNA)
- X-Idempotency-Key: UUID (Clave para evitar operaciones duplicadas)

#### PATH PARAMETERS:
Ninguno

#### QUERY PARAMETERS:
Ninguno

#### REQUEST BODY (Estructura JSON Completa):
{
  "solicitudId": "string",
  "tipoDocumento": "string",
  "nombreArchivo": "string",
  "fuenteDocumento": {
    "tipo": "string",
    "contenidoBase64": "string",
    "referenciaRepositorio": {
      "repositorioId": "string",
      "documentoId": "string",
      "versionId": "string"
    }
  },
  "metadatos": {
    "tipoTramite": "string",
    "numeroSolicitud": "string",
    "dniSolicitante": "string",
    "fechaGeneracion": "YYYY-MM-DDThh:mm:ss±hh:mm"
  },
  "configuracionProteccion": {
    "usarConfiguracionPorDefecto": "boolean",
    "algoritmoCompresion": "string",
    "nivelCompresion": "string"
  },
  "destinatario": {
    "email": "string",
    "telefono": "string",
    "nombreCompleto": "string"
  }
}

#### DETALLE DE CAMPOS DEL REQUEST:
- solicitudId: String (Obligatorio, 36-36 caracteres)
- tipoDocumento: String (Obligatorio, 3-50 caracteres)
- nombreArchivo: String (Obligatorio, 5-200 caracteres)
- fuenteDocumento: Object (Obligatorio)
- fuenteDocumento.tipo: String (Obligatorio, 5-20 caracteres)
- fuenteDocumento.contenidoBase64: String (Condicional, 1-NA caracteres)
- fuenteDocumento.referenciaRepositorio: Object (Condicional)
- fuenteDocumento.referenciaRepositorio.repositorioId: String (Condicional, 3-50 caracteres)
- fuenteDocumento.referenciaRepositorio.documentoId: String (Condicional, 36-36 caracteres)
- fuenteDocumento.referenciaRepositorio.versionId: String (No obligatorio, 1-20 caracteres)
- metadatos: Object (Obligatorio)
- metadatos.tipoTramite: String (Obligatorio, 3-50 caracteres)
- metadatos.numeroSolicitud: String (Obligatorio, 5-30 caracteres)
- metadatos.dniSolicitante: String (Obligatorio, 8-8 caracteres)
- metadatos.fechaGeneracion: String/Date ISO 8601 (Obligatorio)
- configuracionProteccion: Object (No obligatorio)
- configuracionProteccion.usarConfiguracionPorDefecto: Boolean (No obligatorio)
- configuracionProteccion.algoritmoCompresion: String (No obligatorio, 3-20 caracteres)
- configuracionProteccion.nivelCompresion: String (No obligatorio, 4-10 caracteres)
- destinatario: Object (No obligatorio)
- destinatario.email: String (No obligatorio, 5-254 caracteres)
- destinatario.telefono: String (No obligatorio, 7-15 caracteres)
- destinatario.nombreCompleto: String (No obligatorio, 3-200 caracteres)

#### RESPONSE BODY (Estructura JSON Completa - Éxito):
{
  "success": "boolean",
  "data": {
    "proteccionId": "string",
    "solicitudId": "string",
    "archivoProtegido": {
      "repositorioId": "string",
      "documentoId": "string",
      "nombreArchivo": "string",
      "tamanioBytes": "integer",
      "formatoSalida": "string",
      "checksumSHA256": "string"
    },
    "seguridad": {
      "passwordHashSHA512": "string",
      "algoritmoUtilizado": "string",
      "longitudPassword": "integer",
      "fechaGeneracion": "YYYY-MM-DDThh:mm:ss±hh:mm",
      "fechaExpiracion": "YYYY-MM-DDThh:mm:ss±hh:mm"
    },
    "compresion": {
      "algoritmo": "string",
      "nivelCompresion": "string",
      "tamanioOriginal": "integer",
      "tamanioComprimido": "integer",
      "ratioCompresion": "number"
    },
    "estado": "string",
    "fechaProcesamiento": "YYYY-MM-DDThh:mm:ss±hh:mm",
    "_links": {
      "self": "string",
      "descargar": "string",
      "verificar": "string"
    }
  },
  "metadata": {
    "timestamp": "YYYY-MM-DDThh:mm:ss±hh:mm",
    "correlationId": "string",
    "version": "string",
    "tiempoRespuesta": "string"
  }
}

#### ERROR RESPONSE (Estructura JSON Completa):
{
  "error": {
    "tipo": "string",
    "titulo": "string",
    "estado": "integer",
    "errores": [
      {
        "detalleError": "string"
      }
    ]
  }
}

#### STATUS CODES:
- 201: Created - Documento comprimido y protegido exitosamente
- 400: Bad Request - Datos inválidos o formato de documento incorrecto
- 401: Unauthorized - Token JWT inválido o expirado
- 403: Forbidden - Usuario sin permisos para proteger documentos
- 404: Not Found - Documento de origen no encontrado en repositorio
- 409: Conflict - El documento ya fue protegido anteriormente
- 413: Payload Too Large - El documento excede el tamaño máximo permitido
- 422: Unprocessable Entity - Documento válido pero no procesable
- 429: Too Many Requests - Límite de rate limit excedido
- 500: Internal Server Error - Error interno del servidor
- 502: Bad Gateway - Error de comunicación con MsDatosConfiguracion o MsGestorDocumentos
- 503: Service Unavailable - Servicio temporalmente no disponible

## 5. ENTIDADES DEL DOMINIO

### ENTIDAD 1: SolicitudProteccion
- solicitudId: String (UUID, 36 caracteres)
- tipoDocumento: String (3-50 caracteres)
- nombreArchivo: String (5-200 caracteres)
- fuenteDocumento: FuenteDocumento
- metadatos: MetadatosSolicitud
- configuracionProteccion: ConfiguracionProteccion
- destinatario: Destinatario

### ENTIDAD 2: FuenteDocumento
- tipo: String (5-20 caracteres)
- contenidoBase64: String (Condicional)
- referenciaRepositorio: ReferenciaRepositorio (Condicional)

### ENTIDAD 3: ReferenciaRepositorio
- repositorioId: String (3-50 caracteres)
- documentoId: String (UUID, 36 caracteres)
- versionId: String (1-20 caracteres, Opcional)

### ENTIDAD 4: MetadatosSolicitud
- tipoTramite: String (3-50 caracteres)
- numeroSolicitud: String (5-30 caracteres)
- dniSolicitante: String (8 caracteres)
- fechaGeneracion: LocalDateTime

### ENTIDAD 5: ConfiguracionProteccion
- usarConfiguracionPorDefecto: Boolean
- algoritmoCompresion: String (3-20 caracteres, Opcional)
- nivelCompresion: String (4-10 caracteres, Opcional)

### ENTIDAD 6: Destinatario
- email: String (5-254 caracteres, Opcional)
- telefono: String (7-15 caracteres, Opcional)
- nombreCompleto: String (3-200 caracteres, Opcional)

### ENTIDAD 7: DocumentoProtegido
- proteccionId: String (UUID)
- solicitudId: String (UUID)
- archivoProtegido: ArchivoProtegido
- seguridad: InformacionSeguridad
- compresion: EstadisticasCompresion
- estado: String (COMPLETADO, ERROR)
- fechaProcesamiento: LocalDateTime
- links: LinksHATEOAS

### ENTIDAD 8: ArchivoProtegido
- repositorioId: String
- documentoId: String
- nombreArchivo: String
- tamanioBytes: Long
- formatoSalida: String (ZIP)
- checksumSHA256: String

### ENTIDAD 9: InformacionSeguridad
- passwordHashSHA512: String
- algoritmoUtilizado: String
- longitudPassword: Integer (16 caracteres)
- fechaGeneracion: LocalDateTime
- fechaExpiracion: LocalDateTime (Opcional)

### ENTIDAD 10: EstadisticasCompresion
- algoritmo: String
- nivelCompresion: String
- tamanioOriginal: Long (bytes)
- tamanioComprimido: Long (bytes)
- ratioCompresion: Double

### ENTIDAD 11: LinksHATEOAS
- self: String (URL)
- descargar: String (URL)
- verificar: String (URL)

## 6. REGLAS DE NEGOCIO

1. Política de Seguridad: El microservicio implementa la política de seguridad de distribución documental de RENIEC
2. Protección con Contraseña: Todo documento comprimido debe ser protegido con una contraseña generada automáticamente de 16 caracteres
3. Hash de Seguridad: Se utiliza SHA-512 para hashear la contraseña y SHA-256 para el checksum del archivo
4. Formato de Salida: El archivo resultante siempre es en formato ZIP
5. Condicionalidad de Fuente: El campo contenidoBase64 o referenciaRepositorio son condicionales - se usa uno u otro según el tipo de fuente
6. Validación de DNI: El DNI del solicitante debe tener exactamente 8 caracteres
7. UUID Estándar: Los identificadores deben ser UUIDs de 36 caracteres
8. Idempotencia: Se utiliza X-Idempotency-Key para evitar operaciones duplicadas
9. Trazabilidad: Todas las operaciones deben incluir X-Correlation-ID para trazabilidad end-to-end
10. HATEOAS: Las respuestas incluyen enlaces para operaciones relacionadas
11. Configuración por Defecto: El sistema puede usar configuración por defecto si no se especifica algoritmo o nivel de compresión

## 7. INTEGRACIONES

El microservicio se integra con:
- MsDatosConfiguracion: Para obtener configuraciones de compresión y protección
- MsGestorDocumentos: Para almacenar y recuperar documentos del repositorio
